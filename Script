--// ￰ﾟﾎﾨ Cheat a Steal - Executor vFinal: Dual Mutation Squares + Global Search

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local map = workspace:WaitForChild("Map")
local tycoons = map:WaitForChild("Tycoons")

local openPlayerFrames = {}
local globalSearchFrame

-- Get tycoon folder by owner
local function getTycoonOf(playerName)
	for _, tycoon in ipairs(tycoons:GetChildren()) do
		if tycoon:GetAttribute("Owner") == playerName then
			return tycoon
		end
	end
end

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ExecutorUI"
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:FindFirstChildOfClass("PlayerGui") or Instance.new("ScreenGui", LocalPlayer)

-- MAIN FRAME
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 500)
mainFrame.Position = UDim2.new(0.5, -175, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(28, 35, 50)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 14)

-- Order 1: Title
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -20, 0, 35)
titleLabel.Position = UDim2.new(0, 10, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.Font = Enum.Font.GothamBold
titleLabel.Text = "Arrest a Brainrot"
titleLabel.TextSize = 18
titleLabel.TextColor3 = Color3.fromRGB(180, 220, 255)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = mainFrame

-- Order 2: Player buttons scroll
local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, -20, 0, 350)
scroll.Position = UDim2.new(0, 10, 0, 55)
scroll.BackgroundColor3 = Color3.fromRGB(35, 45, 60)
scroll.ScrollBarThickness = 6
scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
scroll.Parent = mainFrame
local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0, 6)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Left
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Parent = scroll

-- Order 3: Global search textbox
local searchBox = Instance.new("TextBox")
searchBox.Size = UDim2.new(1, -20, 0, 35)
searchBox.Position = UDim2.new(0, 10, 0, 420)
searchBox.BackgroundColor3 = Color3.fromRGB(30, 40, 55)
searchBox.PlaceholderText = "Search global models..."
searchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
searchBox.Font = Enum.Font.Gotham
searchBox.TextSize = 16
searchBox.Parent = mainFrame
Instance.new("UICorner", searchBox).CornerRadius = UDim.new(0, 8)

-- Create global search frame
local function createGlobalSearchFrame()
	if globalSearchFrame then globalSearchFrame:Destroy() end
	globalSearchFrame = Instance.new("Frame")
	globalSearchFrame.Size = UDim2.new(0, 300, 0, 400)
	globalSearchFrame.Position = UDim2.new(0.5, 180, 0.2, 0)
	globalSearchFrame.BackgroundColor3 = Color3.fromRGB(28, 35, 50)
	globalSearchFrame.Active = true
	globalSearchFrame.Draggable = true
	globalSearchFrame.Parent = screenGui
	Instance.new("UICorner", globalSearchFrame).CornerRadius = UDim.new(0, 14)

	local closeBtn = Instance.new("TextButton")
	closeBtn.Size = UDim2.new(0, 30, 0, 30)
	closeBtn.Position = UDim2.new(1, -35, 0, 5)
	closeBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
	closeBtn.Text = "X"
	closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.TextSize = 18
	closeBtn.AutoButtonColor = true
	closeBtn.Parent = globalSearchFrame
	Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 6)
	closeBtn.MouseButton1Click:Connect(function()
		globalSearchFrame:Destroy()
		globalSearchFrame = nil
	end)

	local scrollResults = Instance.new("ScrollingFrame")
	scrollResults.Size = UDim2.new(1, -20, 1, -50)
	scrollResults.Position = UDim2.new(0, 10, 0, 40)
	scrollResults.BackgroundColor3 = Color3.fromRGB(35, 45, 60)
	scrollResults.ScrollBarThickness = 6
	scrollResults.CanvasSize = UDim2.new(0, 0, 0, 0)
	scrollResults.Parent = globalSearchFrame
	local list = Instance.new("UIListLayout")
	list.Padding = UDim.new(0, 5)
	list.Parent = scrollResults

	return scrollResults
end

-- Global search logic
local function updateGlobalSearch()
	local text = searchBox.Text:lower()
	if text == "" then
		if globalSearchFrame then globalSearchFrame:Destroy() end
		globalSearchFrame = nil
		return
	end
	local scrollResults = createGlobalSearchFrame()
	scrollResults:ClearAllChildren()
	local totalHeight = 0

	for _, tycoon in ipairs(tycoons:GetChildren()) do
		local tempFolder = tycoon:FindFirstChild("Temporary")
		if tempFolder then
			for _, model in ipairs(tempFolder:GetChildren()) do
				if model:IsA("Model") then
					local trashInfo = model:FindFirstChild("TrashInfo")
					local visibleRarity = ""
					if trashInfo then
						for _, obj in ipairs(trashInfo:GetChildren()) do
							if obj:IsA("TextLabel") and obj.Name == "Rarity" and obj.Visible then
								visibleRarity = obj.Text:lower()
								break
							end
						end
					end
					if model.Name:lower():find(text) or visibleRarity:find(text) then
						local b = Instance.new("TextButton")
						b.Size = UDim2.new(1, 0, 0, 35)
						b.BackgroundColor3 = Color3.fromRGB(70, 130, 220)
						b.Text = ""
						b.Parent = scrollResults
						Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

						local label = Instance.new("TextLabel")
						label.Size = UDim2.new(0.6, 0, 1, 0)
						label.Position = UDim2.new(0, 5, 0, 0)
						label.BackgroundTransparency = 1
						label.Text = model.Name
						label.TextColor3 = Color3.fromRGB(255, 255, 255)
						label.Font = Enum.Font.Gotham
						label.TextSize = 16
						label.TextXAlignment = Enum.TextXAlignment.Left
						label.Parent = b

						-- Handle 1 or 2 visible mutation templates
						local squares = {}
						if trashInfo then
							local visibleMutations = {}
							for _, obj in ipairs(trashInfo:GetChildren()) do
								if obj:IsA("TextLabel") and obj.Name == "MutationTemplate" and obj.Visible then
									table.insert(visibleMutations, obj)
								end
							end
							for i, mutation in ipairs(visibleMutations) do
								local square = Instance.new("Frame")
								square.Size = UDim2.new(0, 25, 0, 25)
								square.Position = UDim2.new(1, -35 - ((i-1)*30), 0.5, -12)
								square.BackgroundColor3 = mutation.TextColor3
								square.Parent = b
								local stroke = Instance.new("UIStroke", square)
								stroke.Thickness = 2
								stroke.Color = Color3.new(0, 0, 0)
								Instance.new("UICorner", square).CornerRadius = UDim.new(0, 5)
								table.insert(squares, square)
							end
						end

						b.MouseButton1Click:Connect(function()
							local root = model:FindFirstChild("Root")
							if root and LocalPlayer.Character then
								LocalPlayer.Character:PivotTo(root.CFrame)
							end
						end)

						totalHeight = totalHeight + 35 + 5
					end
				end
			end
		end
	end
	scrollResults.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
end
searchBox:GetPropertyChangedSignal("Text"):Connect(updateGlobalSearch)

-- PLAYER BUTTONS WITH TIMER CUBES
local function makePlayerButton(playerName)
	local container = Instance.new("Frame")
	container.Size = UDim2.new(1, 0, 0, 40)
	container.BackgroundTransparency = 1
	container.Parent = scroll

	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.8, 0, 1, 0)
	btn.Position = UDim2.new(0, 0, 0, 0)
	btn.BackgroundColor3 = Color3.fromRGB(70, 130, 220)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.Gotham
	btn.Text = playerName
	btn.TextSize = 17
	btn.AutoButtonColor = true
	btn.Parent = container
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

	local timerCube = Instance.new("TextButton")
	timerCube.Size = UDim2.new(0, 50, 1, 0)
	timerCube.Position = UDim2.new(0.8, 5, 0, 0)
	timerCube.BackgroundColor3 = Color3.fromRGB(40, 90, 180)
	timerCube.TextColor3 = Color3.fromRGB(255, 255, 255)
	timerCube.Font = Enum.Font.GothamBold
	timerCube.TextSize = 16
	timerCube.Text = "..."
	timerCube.AutoButtonColor = false
	timerCube.Parent = container
	Instance.new("UICorner", timerCube).CornerRadius = UDim.new(0, 6)

	local conn
	local function updateTimer()
		local tycoon = getTycoonOf(playerName)
		if not tycoon then
			timerCube.Text = "N/A"
			return
		end
		local tycoonModel = tycoon:FindFirstChild("Tycoon")
		local ffFolder = tycoonModel and tycoonModel:FindFirstChild("ForcefieldFolder")
		local screenModel = ffFolder and ffFolder:FindFirstChild("Screen")
		local screenPart = screenModel and screenModel:FindFirstChild("Screen")
		local gui = screenPart and screenPart:FindFirstChild("SurfaceGui")
		local timeLabel = gui and gui:FindFirstChild("Time")
		if not timeLabel then
			timerCube.Text = "N/A"
			return
		end
		if conn then conn:Disconnect() end
		conn = RunService.Heartbeat:Connect(function()
			if not timeLabel or not timeLabel.Parent then
				timerCube.Text = "N/A"
				return
			end
			timerCube.Text = (timeLabel.Text == "0s") and "Open" or timeLabel.Text
		end)
	end
	updateTimer()

	btn.MouseButton1Click:Connect(function()
		if openPlayerFrames[playerName] then
			openPlayerFrames[playerName]:Destroy()
			openPlayerFrames[playerName] = nil
		end

		local tycoon = getTycoonOf(playerName)
		if not tycoon then return end
		local tycoonTemp = tycoon:FindFirstChild("Temporary")
		local tycoonModel = tycoon:FindFirstChild("Tycoon")
		local ffFolder = tycoonModel and tycoonModel:FindFirstChild("ForcefieldFolder")
		local screenModel = ffFolder and ffFolder:FindFirstChild("Screen")
		local screenPart = screenModel and screenModel:FindFirstChild("Screen")
		local gui = screenPart and screenPart:FindFirstChild("SurfaceGui")
		local timeLabel = gui and gui:FindFirstChild("Time")

		local frame = Instance.new("Frame")
		frame.Size = UDim2.new(0, 300, 0, 400)
		frame.Position = UDim2.new(0.5, 180, 0.2, 0)
		frame.BackgroundColor3 = Color3.fromRGB(28, 35, 50)
		frame.Active = true
		frame.Draggable = true
		frame.Parent = screenGui
		Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 14)

		local closeBtn = Instance.new("TextButton")
		closeBtn.Size = UDim2.new(0, 30, 0, 30)
		closeBtn.Position = UDim2.new(1, -35, 0, 5)
		closeBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
		closeBtn.Text = "X"
		closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
		closeBtn.Font = Enum.Font.GothamBold
		closeBtn.TextSize = 18
		closeBtn.AutoButtonColor = true
		closeBtn.Parent = frame
		Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 6)
		closeBtn.MouseButton1Click:Connect(function()
			frame:Destroy()
			openPlayerFrames[playerName] = nil
		end)

		-- Timer label
		local timerLabel = Instance.new("TextLabel")
		timerLabel.Size = UDim2.new(1, -10, 0, 40)
		timerLabel.Position = UDim2.new(0, 5, 0, 35)
		timerLabel.BackgroundTransparency = 1
		timerLabel.Font = Enum.Font.Gotham
		timerLabel.TextColor3 = Color3.fromRGB(140, 220, 255)
		timerLabel.TextSize = 22
		timerLabel.Text = "Loading..."
		timerLabel.Parent = frame

		local conn2
		conn2 = RunService.Heartbeat:Connect(function()
			if not timeLabel or not timeLabel.Parent or not frame.Parent then
				conn2:Disconnect()
				return
			end
			timerLabel.Text = (timeLabel.Text == "0s") and "Open" or timeLabel.Text
		end)

		-- Player models scroll
		local modelsScroll = Instance.new("ScrollingFrame")
		modelsScroll.Size = UDim2.new(1, -20, 1, -90)
		modelsScroll.Position = UDim2.new(0, 10, 0, 85)
		modelsScroll.BackgroundColor3 = Color3.fromRGB(35, 45, 60)
		modelsScroll.ScrollBarThickness = 6
		modelsScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
		modelsScroll.Parent = frame
		local list = Instance.new("UIListLayout")
		list.Padding = UDim.new(0, 5)
		list.Parent = modelsScroll

		local totalHeight = 0
		if tycoonTemp then
			for _, model in ipairs(tycoonTemp:GetChildren()) do
				if model:IsA("Model") then
					local b = Instance.new("TextButton")
					b.Size = UDim2.new(1, 0, 0, 35)
					b.BackgroundColor3 = Color3.fromRGB(70, 130, 220)
					b.Text = ""
					b.Parent = modelsScroll
					Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

					local label = Instance.new("TextLabel")
					label.Size = UDim2.new(0.6, 0, 1, 0)
					label.Position = UDim2.new(0, 5, 0, 0)
					label.BackgroundTransparency = 1
					label.Text = model.Name
					label.TextColor3 = Color3.fromRGB(255, 255, 255)
					label.Font = Enum.Font.Gotham
					label.TextSize = 16
					label.TextXAlignment = Enum.TextXAlignment.Left
					label.Parent = b

					-- Mutation squares (1 or 2)
					local trashInfo = model:FindFirstChild("TrashInfo")
					if trashInfo then
						local visibleMutations = {}
						for _, obj in ipairs(trashInfo:GetChildren()) do
							if obj:IsA("TextLabel") and obj.Name == "MutationTemplate" and obj.Visible then
								table.insert(visibleMutations, obj)
							end
						end
						for i, mutation in ipairs(visibleMutations) do
							local square = Instance.new("Frame")
							square.Size = UDim2.new(0, 25, 0, 25)
							square.Position = UDim2.new(1, -35 - ((i-1)*30), 0.5, -12)
							square.BackgroundColor3 = mutation.TextColor3
							square.Parent = b
							local stroke = Instance.new("UIStroke", square)
							stroke.Thickness = 2
							stroke.Color = Color3.new(0, 0, 0)
							Instance.new("UICorner", square).CornerRadius = UDim.new(0, 5)
						end
					end

					b.MouseButton1Click:Connect(function()
						local root = model:FindFirstChild("Root")
						if root and LocalPlayer.Character then
							LocalPlayer.Character:PivotTo(root.CFrame)
						end
					end)

					totalHeight = totalHeight + 35 + 5
				end
			end
		end
		modelsScroll.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
		openPlayerFrames[playerName] = frame
	end)
end

-- REFRESH PLAYER BUTTONS
local function refresh()
	scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	for _, old in ipairs(scroll:GetChildren()) do
		if old:IsA("Frame") then old:Destroy() end
	end
	local totalHeight = 0
	for _, plr in ipairs(Players:GetPlayers()) do
		makePlayerButton(plr.Name)
		totalHeight = totalHeight + 40 + 6
	end
	scroll.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
end

refresh()
Players.PlayerAdded:Connect(refresh)
Players.PlayerRemoving:Connect(refresh)
